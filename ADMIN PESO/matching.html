<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Matching | SKILLocal Admin</title>
  <link rel="stylesheet" href="matching.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
</head>
<body class="dashboard-body">
  
  <aside class="sidebar">
    <h2 class="logo">SKILlocal</h2>
    <nav>
      <a href="dashboard.html">üìä Dashboard</a>
      <a href="users.html">üë• Users</a>
      <a href="establishments.html">üè¢ Establishments</a>
      <a href="vacancies.html">üíº Job Vacancies</a>
      <a href="applications.html">üìÑ Applications</a>
      <a href="matching.html" class="active">üîç Matching</a>
      <a href="masterdata.html">‚öôÔ∏è Master Data</a>
      <a href="profile.html">üë§ Profile</a>
      <a href="login.html" class="logout">Logout</a>
    </nav>
  </aside>

  
  <main class="main-content">
    <header class="header">
      <div>
        <h1>üîç Job Matching</h1>
        <p>Matches between skilled worker applications and available vacancies in General Santos City.</p>
      </div>
      <div class="timestamp" id="timestamp"></div>
    </header>

   
    <div class="top-controls">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search matches..." />
      </div>
      <div style="display:flex; gap:10px; align-items:center;">
        <button id="runMatching" class="btn-action">
          <span id="runText">Run Matching</span>
          <span id="spinner" class="spinner" style="display:none;"></span>
        </button>
        <button id="btnNewMatch" class="btn-add"><i class="bi bi-plus-circle"></i> New Match</button>
      </div>
    </div>

    
    <section class="matching-section">
      <div class="card">
        <h3>Match Results</h3>
        <div class="table-wrapper">
          <table id="matchingTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Applicant Name</th>
                <th>Applied Job</th>
                <th>Matched Vacancy</th>
                <th>Establishment</th>
                <th>Match Score</th>
                <th>Status</th>
                <th>Date Matched</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <tr>
                <td>1</td>
                <td>Juan Dela Cruz</td>
                <td>Electrician</td>
                <td>Electrical Maintenance Technician</td>
                <td>PowerWorks GenSan</td>
                <td>87%</td>
                <td><span class="badge active">Matched</span></td>
                <td>Oct 7, 2025</td>
                <td class="action-icons">
                  <i class="bi bi-eye-fill icon-view"></i>
                  <i class="bi bi-check2-square icon-accept"></i>
                  <i class="bi bi-x-square icon-reject"></i>
                  <i class="bi bi-trash3-fill icon-delete"></i>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  
  <div class="modal-overlay" id="addModal">
    <div class="modal">
      <h2>‚ûï New Match</h2>
      <form id="addMatchForm">
        <label>Applicant Name:</label>
        <input type="text" id="applicant" required />
        <label>Applied Job:</label>
        <input type="text" id="appliedJob" required />
        <label>Matched Vacancy:</label>
        <input type="text" id="vacancy" required />
        <label>Establishment:</label>
        <input type="text" id="establishment" required />
        <label>Match Score:</label>
        <input type="text" id="score" placeholder="e.g., 85%" required />
        <div class="modal-actions">
          <button type="button" class="btn-cancel" id="cancelAdd">Cancel</button>
          <button type="submit" class="btn-save">Save Match</button>
        </div>
      </form>
    </div>
  </div>

 
  <div class="modal-overlay" id="viewModal">
    <div class="modal view-modal">
      <h2>üëÅÔ∏è View Match</h2>
      <div id="viewDetails"></div>
      <div class="modal-actions">
        <button class="btn-close" id="closeView">Close</button>
      </div>
    </div>
  </div>

  
  <div class="modal-overlay" id="deleteModal">
    <div class="modal">
      <h2>‚ö†Ô∏è Delete Match</h2>
      <p>Are you sure you want to delete this match?</p>
      <div class="modal-actions">
        <button class="btn-cancel" id="cancelDelete">Cancel</button>
        <button class="btn-delete" id="confirmDelete">Delete</button>
      </div>
    </div>
  </div>

  
  <script>
    const timestamp = document.getElementById("timestamp");
    function updateTimestamp() {
      timestamp.textContent = new Date().toLocaleString("en-PH", {
        dateStyle: "full",
        timeStyle: "medium",
      });
    }
    setInterval(updateTimestamp, 1000);
    updateTimestamp();

    const addModal = document.getElementById("addModal");
    const viewModal = document.getElementById("viewModal");
    const deleteModal = document.getElementById("deleteModal");
    const btnNewMatch = document.getElementById("btnNewMatch");
    const cancelAdd = document.getElementById("cancelAdd");
    const closeView = document.getElementById("closeView");
    const cancelDelete = document.getElementById("cancelDelete");
    const confirmDelete = document.getElementById("confirmDelete");
    const tableBody = document.getElementById("tableBody");
    let deleteRow = null;

    
    btnNewMatch.onclick = () => (addModal.style.display = "flex");
    cancelAdd.onclick = () => (addModal.style.display = "none");

   
    document.getElementById("addMatchForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const date = new Date().toLocaleDateString("en-PH", {
        month: "short",
        day: "numeric",
        year: "numeric"
      });
      const newRow = document.createElement("tr");
      newRow.innerHTML = `
        <td>${tableBody.rows.length + 1}</td>
        <td>${applicant.value}</td>
        <td>${appliedJob.value}</td>
        <td>${vacancy.value}</td>
        <td>${establishment.value}</td>
        <td>${score.value}</td>
        <td><span class="badge pending">Pending</span></td>
        <td>${date}</td>
        <td class="action-icons">
          <i class="bi bi-eye-fill icon-view"></i>
          <i class="bi bi-check2-square icon-accept"></i>
          <i class="bi bi-x-square icon-reject"></i>
          <i class="bi bi-trash3-fill icon-delete"></i>
        </td>`;
      tableBody.appendChild(newRow);
      addModal.style.display = "none";
      e.target.reset();
    });

   
    document.addEventListener("click", (e) => {
      if (e.target.classList.contains("icon-view")) {
        const row = e.target.closest("tr");
        const cells = row.getElementsByTagName("td");
        document.getElementById("viewDetails").innerHTML = `
          <p><b>Applicant:</b> ${cells[1].innerText}</p>
          <p><b>Applied Job:</b> ${cells[2].innerText}</p>
          <p><b>Matched Vacancy:</b> ${cells[3].innerText}</p>
          <p><b>Establishment:</b> ${cells[4].innerText}</p>
          <p><b>Score:</b> ${cells[5].innerText}</p>
          <p><b>Status:</b> ${cells[6].innerText}</p>
          <p><b>Date:</b> ${cells[7].innerText}</p>`;
        viewModal.style.display = "flex";
      }

      if (e.target.classList.contains("icon-accept")) {
        const badge = e.target.closest("tr").querySelector(".badge");
        badge.textContent = "Matched";
        badge.className = "badge active";
      }

      if (e.target.classList.contains("icon-reject")) {
        const badge = e.target.closest("tr").querySelector(".badge");
        badge.textContent = "Rejected";
        badge.className = "badge inactive";
      }

      if (e.target.classList.contains("icon-delete")) {
        deleteRow = e.target.closest("tr");
        deleteModal.style.display = "flex";
      }
    });

    closeView.onclick = () => (viewModal.style.display = "none");
    cancelDelete.onclick = () => (deleteModal.style.display = "none");
    confirmDelete.onclick = () => {
      if (deleteRow) {
        deleteRow.remove();
        deleteRow = null;
      }
      deleteModal.style.display = "none";
    };

    
    const runBtn = document.getElementById("runMatching");
    const runText = document.getElementById("runText");
    const spinner = document.getElementById("spinner");

    runBtn.onclick = () => {
      runBtn.disabled = true;
      spinner.style.display = "inline-block";
      runText.textContent = "Running...";
      setTimeout(() => {
        spinner.style.display = "none";
        runText.textContent = "Run Matching";
        runBtn.disabled = false;
        alert("‚úÖ Matching simulation complete! New potential matches found.");
      }, 2500);
    };
  </script>
</body>
</html>
